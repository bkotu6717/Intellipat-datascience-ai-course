CREATE DATABASE May28Session
use May28Session

CREATE TABLE LOCATION(
    id INTEGER PRIMARY KEY,
    city VARCHAR(30)
)

insert into [LOCATION] VALUES
(122, 'NewYork'),
(123, 'Dallas'),
(124, 'Chicago'),
(167, 'Boston')

SELECT * from [LOCATION];


CREATE TABLE department(
    id INTEGER PRIMARY KEY,
    name VARCHAR(100),
    location_id INTEGER REFERENCES LOCATION(id)
)


INSERT INTO department VALUES
(10, 'Accounting', 122),
(20, 'Sales', 123),
(30, 'Research', 124),
(40, 'Operations', 167)

select * from department;

CREATE TABLE job(
    id INTEGER PRIMARY KEY,
    designation VARCHAR(100)
)

insert into job VALUES
(667,'Clerk'),
(668,'Staff'),
(669,'Analyst'),
(670,'SalesPerson'),
(671,'Manager'),
(672,'Specialist');

SELECT * FROM job;

drop table employee;
CREATE TABLE EMPLOYEE(
    EMPLOYEE_ID INT, LAST_NAME VARCHAR(50), 
    FIRST_NAME VARCHAR(50), 
    MIDDLE_NAME VARCHAR(50),
    EMPJOB_ID INT FOREIGN KEY REFERENCES JOB(id), 
    MANAGER_ID INT, 
    HIRE_DATE DATE, 
    SALARY INT, 
    COMM INT,
    EMP_DEPARTMENT_ID INT FOREIGN KEY REFERENCES DEPARTMENT(id)
)

INSERT INTO EMPLOYEE VALUES
(7369, 'SMITH','JOHN','Q',667,7902,'17-DEC-84',800,NULL,20),
(7499, 'ALLEN','KEVIN','J',670,7698,'20-FEB-85',1600,300,30),
(7505, 'DOYLE','JEAN','K',671,7839,'4-APR-85',2850,NULL,30),
(7506, 'DENNIS','LYNN','S',671,7839,'15-MAY-85',2750,NULL,30),
(7507, 'BAKER','LESLIE','D',671,7839,'10-JUN-85',2200,NULL,40),
(7521, 'WARK','CYNTHIA','D',670,7698,'22-FEB-85',1250,500,30);



-- GROUP BY & HAVING CLAUSE
-- 1. HOW MANY EMPLOYEES WHO ARE IN DIFFERENT DEPARTMENTS WISE IN THE ORGANIZATION.
    SELECT * FROM EMPLOYEE;
    SELECT * FROM department;

    SELECT EMP_DEPARTMENT_ID, COUNT(*) as "Total employees" FROM EMPLOYEE GROUP BY EMP_DEPARTMENT_ID;
    
-- 2. LIST OUT THE DEPARTMENT WISE MAXIMUM SALARY, MINIMUM SALARY, AVERAGE SALARY OF THE EMPLOYEES.
    SELECT * FROM EMPLOYEE;
    SELECT * FROM department;
    SELECT EMP_DEPARTMENT_ID, MAX(SALARY) as MAX_SALARY, MIN(SALARY) as MIN_SALARY, AVG(SALARY) as AVG_SALARY FROM EMPLOYEE GROUP BY EMP_DEPARTMENT_ID;


-- 3. LIST OUT JOB WISE MAXIMUM SALARY, MINIMUM SALARY, AVERAGE SALARIES OF THE EMPLOYEES.
    SELECT EMPJOB_ID, MAX(SALARY) as MAX_SALARY, MIN(SALARY) as MIN_SALARY, AVG(SALARY) as AVG_SALARY FROM EMPLOYEE GROUP BY EMPJOB_ID;


-- 4. LIST OUT THE NUMBER OF EMPLOYEES JOINED IN EVERY MONTH IN ASCENDING ORDER.
    SELECT * FROM EMPLOYEE;
    SELECT MONTH(HIRE_DATE) as JOINING_MONTH, COUNT(*) as [TOTAL EMPLOYEES] FROM EMPLOYEE GROUP BY MONTH(HIRE_DATE) ORDER BY COUNT(*);

-- 5. LIST OUT THE NUMBER OF EMPLOYEES FOR EACH MONTH AND YEAR, IN THE ASCENDING ORDER BASED ON THE YEAR, MONTH.
    SELECT FORMAT(HIRE_DATE, 'MMMM, yyyy') , COUNT(*) AS TOTAL_EMPLOYEES FROM  EMPLOYEE GROUP BY FORMAT(HIRE_DATE, 'MMMM, yyyy') ORDER BY COUNT(*);

-- 6. LIST OUT THE DEPARTMENT ID HAVING ATLEAST FOUR EMPLOYEES.
    SELECT EMP_DEPARTMENT_ID, COUNT(*) FROM EMPLOYEE GROUP BY EMP_DEPARTMENT_ID HAVING COUNT(EMP_DEPARTMENT_ID) >= 4;

-- 7. HOW MANY EMPLOYEES JOINED IN JANUARY MONTH.
    SELECT COUNT(*) as [TOTAL EMPLOYESS] FROM EMPLOYEE WHERE MONTH(HIRE_DATE) = 1

-- 8. HOW MANY EMPLOYEES JOINED IN JANUARY OR SEPTEMBER MONTH.
    SELECT COUNT(*) as [TOTAL EMPLOYESS] FROM EMPLOYEE WHERE MONTH(HIRE_DATE) IN (1,9)

-- 9. HOW MANY EMPLOYEES WERE JOINED IN 1985?
    SELECT COUNT(*) as [TOTAL EMPLOYESS] FROM EMPLOYEE WHERE YEAR(HIRE_DATE) IN (1985) 
-- 10. HOW MANY EMPLOYEES WERE JOINED EACH MONTH IN 1985.
    SELECT MONTH(HIRE_DATE) as HIRE_MONTH, COUNT(*) as [TOTAL EMPLOYESS] FROM EMPLOYEE WHERE YEAR(HIRE_DATE) IN (1985) GROUP BY MONTH(HIRE_DATE);

-- 11. HOW MANY EMPLOYEES WERE JOINED IN MARCH 1985?
    SELECT * FROM EMPLOYEE;
    SELECT COUNT(*) AS TOTAL_EMPLOYEES FROM  EMPLOYEE where MONTH(HIRE_DATE) = 3 AND YEAR(HIRE_DATE) = 1985;


-- 12. WHICH IS THE DEPARTMENT ID, HAVING GREATER THAN OR EQUAL TO 3 EMPLOYEES JOINED IN APRIL 1985?
    SELECT EMP_DEPARTMENT_ID, COUNT(*) FROM EMPLOYEE WHERE MONTH(HIRE_DATE) = 4 AND YEAR(HIRE_DATE) = 1985 GROUP BY EMP_DEPARTMENT_ID HAVING COUNT(EMP_DEPARTMENT_ID) >= 3
